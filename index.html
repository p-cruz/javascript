<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>
<body> 
    <div class="col text-center">    
        <h1>EJEMPLO2 JSON + AJAX (ANIMALES)</h1>
        <button id="btn" class="btn btn-primary">Muestra animal</button> 
        <div id="animal-info"></div>
    </div>
    <script>
        let contador=0;
        var animalesTotal=[];
        let hayFicheros=true;
        window.addEventListener("load", function(){
            for (let i=1; i<4; i++){
                /*var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var respuestaTexto= xhttp.responseText;
                        var respuestaObjetos = JSON.parse(respuestaTexto);
                        Array.prototype.push.apply(animalesTotal,respuestaObjetos.animales);
                    }
                };
                xhttp.open("GET", `animales${i}.json`, false);
                xhttp.send();*/
                fetch(`animales${i}.json`)
                    .then(response => response.json())
                    .then(data => {
                        Array.prototype.push.apply(animalesTotal, data.animales);
                    })
                    .catch(err => console.log(err))
                }
        })

        var animalContenedor = document.getElementById("animal-info")
        var btn = document.getElementById("btn")    
        

        btn.addEventListener("click", function(){
            if (contador < animalesTotal.length){
                var htmlTexto="<ul class='list-group'>";
                htmlTexto += `<li class='list-group item'> ${animalesTotal[contador].name} es un ${animalesTotal[contador].species} al que le gusta `;
                for (j=0; j<animalesTotal[contador].foods.likes.length; j++){
                    if (j==0){
                        htmlTexto+= animalesTotal[contador].foods.likes[j];
                    }else{
                        htmlTexto+= " y "+ animalesTotal[contador].foods.likes[j];
                    }
                }
                htmlTexto+=" y no le gusta "
                for (j=0; j<animalesTotal[contador].foods.dislikes.length; j++){
                    if (j==0){
                        htmlTexto+= animalesTotal[contador].foods.dislikes[j];
                    }else{
                        htmlTexto+= " y "+ animalesTotal[contador].foods.dislikes[j];
                    }
                }
                htmlTexto+='</ul>'

                animalContenedor.insertAdjacentHTML('beforeend', htmlTexto);
                contador++;
            }
        })
    </script>
</body>
</html>